import random

cardvalues = {
    "[A]": 11,
    "[2]": 2,
    "[3]": 3,
    "[4]": 4,
    "[5]": 5,
    "[6]": 6,
    "[7]": 7,
    "[8]": 8,
    "[9]": 9,
    "[10]": 10,
    "[J]": 10,
    "[Q]": 10,
    "[K]": 10
}

cardSuits = ["S", "H", "C", "D"]
funds = 1000
bet = 0

def cardShuffler():
    global cardLibrary
    global userCards
    global dealerCards
    cardLibrary = []
    userCards = []
    dealerCards = []
    for card in cardvalues:
        for cardSuit in cardSuits:
            cardLibrary.insert(-1, card)

def valuetest(cards):
    totalvalue = 0
    for card in cards:
        totalvalue += cardvalues[card]
    for card in cards:
        if card == "[A]" and totalvalue > 21:
            totalvalue -= 10
    return totalvalue

def testwin(value):
    if value > 21:
        return 3
    elif value == 21:
        return 2
    else:
        return 1

def deal(player, hide=False):
            dealtCard = random.choice(cardLibrary)
            if hide == False:
                print("Dealing " + dealtCard)
            else:
                 print("Dealing [?]")
            player += [dealtCard]
            cardLibrary.remove(dealtCard)

def dealphase(player):
    deal(player)
    deal(dealerCards)
    deal(player)
    deal(dealerCards, True)
    print("Your cards are:")
    print(player[0] + player[1])
    print("Dealer has:")
    print(dealerCards[0] + "[?]")
    return player

def hitfunction(player, bet, funds, answer):
        while answer != "y" or answer != "n":
            print("Hit? (Y/N)")
            answer = input()
            if answer == "y":
                deal(player)
                return player, bet, funds, answer
            elif answer == "n":
                print("Dealers turn.")
                player = dealerCards
                print(dealerCards[0] + dealerCards[1])
                return player, bet, funds, answer
            else:
                print("Try again")

def playphase(player, bet, funds, answer="n"):
    if (valuetest(player)) == 21:
        print("Natural 21")
        bet = bet*1.25
    while answer == "y":
        print("Total Value:")
        print(valuetest(player))
        if testwin(valuetest(player)) == 1:
            infoDump = hitfunction(player, bet, funds, answer)
            answer = infoDump[3]
            funds = infoDump[2]
            bet = infoDump[1]
            player = infoDump[0]
        elif testwin(valuetest(player)) == 2:
            print("You win!")
            funds += bet * 2
            return funds
        elif testwin(valuetest(player)) == 3:
            print("Bust!")
            return funds
    while answer == "n":
        infoDump = playphasedealer(player, bet, funds, answer)
        answer = infoDump[3]
        funds = infoDump[2]
        bet = infoDump[1]
        player = infoDump[0]
    return funds

def playphasedealer(player, bet, funds, answer):
        print("Total Value:")
        print(valuetest(player))
        if (valuetest(player)) == 21 and len(dealerCards) == 2:
            print("Natural 21")
            if sideBet != 0:
                print("Awarding Insurance " + str(sideBet))
                funds += sideBet * 2
        if valuetest(player) > 21:
            print("You win!")
            funds += bet * 2
            answer = "d"
            return player, bet, funds, answer
        elif valuetest(player) == 21:
            print("Bust!")
            answer = "d"
            return player, bet, funds, answer
        elif valuetest(player) <= 16:
            deal(player)
            return player, bet, funds, answer
        else:
            if valuetest(userCards) > valuetest(dealerCards):
                print("You win!")
                funds += bet * 2
                answer = "d"
                return player, bet, funds, answer
            elif valuetest(dealerCards) == valuetest(userCards):
                print("Draw!")
                answer = "d"
                funds += bet
                return player, bet, funds, answer
            elif valuetest(userCards) < valuetest(dealerCards):
                print("You lose!")
                answer = "d"
                return player, bet, funds, answer
            
def betphase(total):
    print("Total funds: " + str(funds))
    print("Bet? (enter amount...)")
    global newBet
    global newFunds
    try:
        amount = int(input())
        newBet = amount
        print("Betting: " + str(newBet))
        newFunds = total
        newFunds -= newBet
        print("Total funds: " + str(newFunds))
    except ValueError:
        print("Enter a valid number")
        betphase(total)

def doublephase(funds, bet, answer="null"):
    global newBet
    global newFunds
    while answer != "y" and answer != "n":
        print("You have: " + str(valuetest(userCards)) + " - Double the bet? (y/n)")
        answer = input()
        if answer == "y":
            newFunds = funds - bet
            newBet = bet * 2
            print("Total funds: " + str(newFunds))
        elif answer == "n":
            return funds, bet
        else:
            print("Try again")

def insurancephase(funds, bet, answer="null"):
    global newFunds
    global sideBet
    while answer != "y" and answer != "n":
        print("Dealer has [A] - Insure your bet? (y/n)")
        answer = input()
        if answer == "y":
            sideBet = bet * 0.5
            newFunds = funds - sideBet
            print("Total funds: " + str(newFunds))
        elif answer == "n":
            return funds, bet
        else:
            print("Try again")
    
while funds > 0:
    sideBet = 0
    cardShuffler()
    betphase(funds)
    funds = newFunds
    bet = newBet
    dealphase(userCards)
    if dealerCards[0] == "[A]" and valuetest(userCards) != 21:
        insurancephase(funds, bet)
    if valuetest(userCards) >= 9 and valuetest(userCards) <= 11:
        doublephase(funds, bet)
    funds = newFunds
    bet = newBet
    funds = playphase(userCards, bet, funds, "y")
print("Out of funds!")